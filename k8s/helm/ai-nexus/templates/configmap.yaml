apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "ai-nexus.fullname" . }}
  labels:
    {{- include "ai-nexus.labels" . | nindent 4 }}
data:
  {{- with .Values.configMap.data }}
  {{- toYaml . | nindent 2 }}
  {{- end }}
  {{- if .Values.distributed.enabled }}
  DISTRIBUTED_BACKEND: {{ .Values.distributed.backend | quote }}
  MASTER_PORT: {{ .Values.distributed.masterPort | quote }}
  WORLD_SIZE: {{ .Values.distributed.workers | quote }}
  {{- if eq .Values.distributed.backend "nccl" }}
  NCCL_SOCKET_IFNAME: {{ .Values.distributed.nccl.socketIfname | quote }}
  NCCL_IB_GID_INDEX: {{ .Values.distributed.nccl.ibGidIndex | quote }}
  NCCL_IB_TC: {{ .Values.distributed.nccl.ibTrafficClass | quote }}
  {{- end }}
  {{- end }}
  {{- if .Values.mlflow.enabled }}
  MLFLOW_TRACKING_URI: {{ .Values.mlflow.trackingUri | quote }}
  MLFLOW_EXPERIMENT_NAME: {{ .Values.mlflow.experimentName | quote }}
  {{- end }}
